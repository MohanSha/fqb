!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("crypto")):"function"==typeof define&&define.amd?define(["crypto"],t):(e=e||self).FQB=t(e.crypto)}(this,function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;t.length>r;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}var c=(e=e&&e.hasOwnProperty("default")?e.default:e).createHmac,u=Object.prototype.hasOwnProperty,l=function(){for(var e=[],t=0;256>t;++t)e.push("%"+((16>t?"0":"")+t.toString(16)).toUpperCase());return e}(),f=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;e.length>n;++n)void 0!==e[n]&&(r[n]=e[n]);return r},p={arrayToObject:f,assign:function(e,t){return Object.keys(t).reduce(function(e,r){return e[r]=t[r],e},e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;t.length>n;++n)for(var i=t[n],o=i.obj[i.prop],a=Object.keys(o),s=0;a.length>s;++s){var c=a[s],u=o[c];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(t.push({obj:o,prop:c}),r.push(u))}return function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(Array.isArray(r)){for(var n=[],i=0;r.length>i;++i)void 0!==r[i]&&n.push(r[i]);t.obj[t.prop]=n}}}(t),e},decode:function(e,t,r){var n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(e,t,r){if(0===e.length)return e;var n="string"==typeof e?e:e+"";if("iso-8859-1"===r)return escape(n).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(var i="",o=0;n.length>o;++o){var a=n.charCodeAt(o);45!==a&&46!==a&&95!==a&&126!==a&&(48>a||a>57)&&(65>a||a>90)&&(97>a||a>122)?128>a?i+=l[a]:2048>a?i+=l[192|a>>6]+l[128|63&a]:a>=55296&&57344>a?(a=65536+((1023&a)<<10|1023&n.charCodeAt(o+=1)),i+=l[240|a>>18]+l[128|a>>12&63]+l[128|a>>6&63]+l[128|63&a]):i+=l[224|a>>12]+l[128|a>>6&63]+l[128|63&a]:i+=n.charAt(o)}return i},isBuffer:function(e){return null!=e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(t,r,n){if(!r)return t;if("object"!=typeof r){if(Array.isArray(t))t.push(r);else{if("object"!=typeof t)return[t,r];(n&&(n.plainObjects||n.allowPrototypes)||!u.call(Object.prototype,r))&&(t[r]=!0)}return t}if("object"!=typeof t)return[t].concat(r);var i=t;return Array.isArray(t)&&!Array.isArray(r)&&(i=f(t,n)),Array.isArray(t)&&Array.isArray(r)?(r.forEach(function(r,i){u.call(t,i)?t[i]&&"object"==typeof t[i]?t[i]=e(t[i],r,n):t.push(r):t[i]=r}),t):Object.keys(r).reduce(function(t,i){var o=r[i];return t[i]=u.call(t,i)?e(t[i],o,n):o,t},i)}},h=String.prototype.replace,d=/%20/g,y={default:"RFC3986",formatters:{RFC1738:function(e){return h.call(e,d,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"},v={brackets:function(e){return e+"[]"},indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},_=Array.isArray,g=Array.prototype.push,m=function(e,t){g.apply(e,_(t)?t:[t])},b=Date.prototype.toISOString,A={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:p.encode,encodeValuesOnly:!1,indices:!1,serializeDate:function(e){return b.call(e)},skipNulls:!1,strictNullHandling:!1},k=function e(t,r,n,i,o,a,s,c,u,l,f,h,d){var y=t;if("function"==typeof s?y=s(r,y):y instanceof Date&&(y=l(y)),null===y){if(i)return a&&!h?a(r,A.encoder,d):r;y=""}if("string"==typeof y||"number"==typeof y||"boolean"==typeof y||p.isBuffer(y))return a?[f(h?r:a(r,A.encoder,d))+"="+f(a(y,A.encoder,d))]:[f(r)+"="+f(y+"")];var v,_=[];if(void 0===y)return _;if(Array.isArray(s))v=s;else{var g=Object.keys(y);v=c?g.sort(c):g}for(var b=0;v.length>b;++b){var k=v[b];o&&null===y[k]||m(_,e(y[k],Array.isArray(y)?n(r,k):r+(u?"."+k:"["+k+"]"),n,i,o,a,s,c,u,l,f,h,d))}return _},O=function(e,t){var r=e,n=t?p.assign({},t):{};if(null!=n.encoder&&"function"!=typeof n.encoder)throw new TypeError("Encoder has to be a function.");var i=void 0===n.delimiter?A.delimiter:n.delimiter,o="boolean"==typeof n.strictNullHandling?n.strictNullHandling:A.strictNullHandling,a="boolean"==typeof n.skipNulls?n.skipNulls:A.skipNulls,s="boolean"==typeof n.encode?n.encode:A.encode,c="function"==typeof n.encoder?n.encoder:A.encoder,u="function"==typeof n.sort?n.sort:null,l=void 0===n.allowDots?A.allowDots:!!n.allowDots,f="function"==typeof n.serializeDate?n.serializeDate:A.serializeDate,h="boolean"==typeof n.encodeValuesOnly?n.encodeValuesOnly:A.encodeValuesOnly,d=n.charset||A.charset;if(void 0!==n.charset&&"utf-8"!==n.charset&&"iso-8859-1"!==n.charset)throw Error("The charset option must be either utf-8, iso-8859-1, or undefined");if(void 0===n.format)n.format=y.default;else if(!Object.prototype.hasOwnProperty.call(y.formatters,n.format))throw new TypeError("Unknown format option provided.");var _,g,b=y.formatters[n.format];"function"==typeof n.filter?r=(g=n.filter)("",r):Array.isArray(n.filter)&&(_=g=n.filter);var O=[];if("object"!=typeof r||null===r)return"";var j=v[n.arrayFormat in v?n.arrayFormat:"indices"in n?n.indices?"indices":"repeat":"indices"];_||(_=Object.keys(r)),u&&_.sort(u);for(var E=0;_.length>E;++E){var P=_[E];a&&null===r[P]||m(O,k(r[P],P,j,o,a,s?c:null,g,u,l,f,b,h,d))}var R=O.join(i),w=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&(w+="iso-8859-1"===d?"utf8=%26%2310003%3B&":"utf8=%E2%9C%93&"),R.length>0?w+R:""},j=function(){function e(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this._name=r,this._modifiers={},this._fields=n,this._compiledValues=[],i&&this.limit(i)}return n(e,[{key:"modifiers",value:function(e){return Object.assign(this._modifiers,e),this}},{key:"getModifiers",value:function(){return this._modifiers}},{key:"getModifier",value:function(e){return this._modifiers[e]?this._modifiers[e]:null}},{key:"limit",value:function(t){return this._modifiers[e.PARAM_LIMIT]=t,this}},{key:"getLimit",value:function(){return this._modifiers[e.PARAM_LIMIT]}},{key:"fields",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return this._fields=this._fields.concat(1===t.length&&Array.isArray(t[0])?t[0]:t),this}},{key:"getFields",value:function(){return this._fields}},{key:"resetCompiledValues",value:function(){this._compiledValues=[]}},{key:"compileModifiers",value:function(){Object.keys(this._modifiers).length&&(this._compiledValues=O(this._modifiers).split("&"))}},{key:"compileFields",value:function(){this._fields.length&&this._compiledValues.push("".concat(e.PARAM_FIELDS,"=").concat(this._fields.join()))}},{key:"compileUrl",value:function(){var e="";return this._compiledValues.length&&(e="?".concat(this._compiledValues.join("&"))),"/".concat(this._name).concat(e)}},{key:"asUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.resetCompiledValues(),e&&this.addAppSecretProofModifier(e),this.compileModifiers(),this.compileFields(),this.compileUrl()}},{key:"toString",value:function(){return this.asUrl()}},{key:"addAppSecretProofModifier",value:function(t){var r=this.getModifier(e.PARAM_ACCESS_TOKEN);r&&(this._modifiers[e.PARAM_APP_SECRET_PROOF]=c("sha256",t).update(r).digest("hex"))}}]),e}();i(j,"PARAM_FIELDS","fields"),i(j,"PARAM_LIMIT","limit"),i(j,"PARAM_ACCESS_TOKEN","access_token"),i(j,"PARAM_APP_SECRET_PROOF","appsecret_proof");var E=function(e){function r(){return t(this,r),s(this,o(r).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(r,j),n(r,[{key:"toEndpoints",value:function(){var e=[];return this.getChildEdges().forEach(function(t){e.push("/".concat(t.join("/")))}),e}},{key:"getChildEdges",value:function(){var e=this,t=[],n=!1;return this._fields.forEach(function(i){i instanceof r&&(n=!0,i.getChildEdges().forEach(function(r){t.push([e._name].concat(r))}))}),n||t.push([this._name]),t}},{key:"compileModifiers",value:function(){var e=this;if(Object.keys(this._modifiers).length){var t=[];Object.keys(this._modifiers).forEach(function(r){t.push("".concat(encodeURIComponent(r),"(").concat(encodeURIComponent(e._modifiers[r]),")"))}),this._compiledValues.push(".".concat(t.join(".")))}}},{key:"compileFields",value:function(){if(this._fields.length){var e=[];this._fields.forEach(function(t){e.push(t instanceof r?t.asUrl():encodeURIComponent(t))}),this._compiledValues.push("{".concat(e.join(","),"}"))}}},{key:"compileUrl",value:function(){var e="";return this._compiledValues.length&&(e=this._compiledValues.join("")),this._name+e}}]),r}(),P=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t(this,e),this._graphNode=void 0,this._graphVersion=void 0,this._appSecret=void 0,this._enableBetaMode=!1,this._config=r,this._graphNode=new j(n),r.hasOwnProperty("accessToken")&&this.accessToken(r.accessToken),r.hasOwnProperty("graphVersion")&&this.graphVersion(r.graphVersion),r.hasOwnProperty("appSecret")&&(this._appSecret=r.appSecret),r.hasOwnProperty("enableBetaMode")&&!0===r.enableBetaMode&&(this._enableBetaMode=!0)}return n(e,[{key:"node",value:function(t){return new e(this._config,t)}},{key:"edge",value:function(e,t){return new E(e,t)}},{key:"fields",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return this._graphNode.fields(1===t.length&&Array.isArray(t[0])?t[0]:t),this}},{key:"accessToken",value:function(e){return this._graphNode.modifiers(Object.assign(this._graphNode._modifiers,{access_token:e})),this}},{key:"graphVersion",value:function(e){return this._graphVersion=e,this}},{key:"limit",value:function(e){return this._graphNode.limit(e),this}},{key:"modifiers",value:function(e){return this._graphNode.modifiers(e),this}},{key:"asUrl",value:function(){return"".concat(this.getHostname()).concat(this.asEndpoint())}},{key:"asEndpoint",value:function(){var e="";return this._graphVersion&&(e="/".concat(this._graphVersion)),"".concat(e).concat(this._graphNode.asUrl(this._appSecret))}},{key:"toString",value:function(){return this.asUrl()}},{key:"getHostname",value:function(){return this._enableBetaMode?e.BASE_GRAPH_URL_BETA:e.BASE_GRAPH_URL}}]),e}();return i(P,"BASE_GRAPH_URL","https://graph.facebook.com"),i(P,"BASE_GRAPH_URL_BETA","https://graph.beta.facebook.com"),P});
